message: |
  This topology sets up an inter-VRF DHCP relay on a VXLAN-extended
  VLAN using EVPN control plane. It includes a DHCP server (running on
  Cisco CSR1000v), DHCP clients (using Cisco IOSv) and two intermediate
  VXLAN/EVPN-enabled switches running Arista vEOS.

provider: clab

defaults.attributes:
  link.dhcp:
    client: bool
    relay: str
    server: bool

groups:
  dhcp_server:
    members: [ srv ]
    # module: [ ospf, vrf ]
    config: [ dhcp-server ]
    # device: srlinux # Only static DHCP entries supported
    # device: sros
    device: linux
    # clab.image: networkboot/dhcpd
    clab.image: strm/dnsmasq
    # clab.binds:
    #  "dhcp-server/data": "/data"
    clab.config_templates:
      # dhcpd: "/data/dhcpd.conf"
      dnsmasq: "/etc/dnsmasq.conf"

  dhcp_client:
    members: [ cl_a, cl_b ]
    config: [ dhcp-client ]
    # device: srlinux # DHCP only supported on mgmt
    # device: sros
    # clab.type: ixr-ec
    device: linux
    clab.image: alpine # python # Netlab needs Python installed
    clab.binds:
      "dhcp-client/alpine.interfaces": "/etc/network/interfaces"
  switch:
    members: [ sw1, sw2 ]
    module: [ ospf,bgp,vrf,vlan,vxlan,gateway,evpn ]
    config: [ dhcp-relay ]
    device: srlinux

vrfs:
  client:
    evpn.transit_vni: True
  # dhcp:
  #   loopback: True

vlans:
  cv1:
    gateway: True
    ospf.passive: True
    vrf: client

  dhcp1:
    ospf.passive: True
    vrf: client

  dhcp2:
    ospf.passive: True
    vrf: client

bgp.as: 65000
gateway.id: 1

nodes: [ srv, sw1, sw2, cl_a, cl_b ]

links:
- srv:
  sw1:
    vlan.access: dhcp1
- srv:
  sw2:
    vlan.access: dhcp2
- sw1-sw2
- cl_a:
    dhcp.client: True
  sw1:
    dhcp.relay: srv
  vlan.access: cv1
- cl_b:
    dhcp.client: True
  sw2:
    dhcp.relay: srv
  vlan.access: cv1

defaults.outputs:
  _include: [ outputs/format.yml ]
