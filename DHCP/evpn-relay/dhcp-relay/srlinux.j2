updates:
{% for intf in interfaces if intf.dhcp.server is defined %}
{%   set if_name_index = intf.ifname.split('.') %}
{%   set if_name = if_name_index[0] if intf.type!='stub' else "lo0" %}
{%   set if_index = if_name_index[1] if if_name_index|length > 1 else intf.ifindex if intf.type=='stub' else '0' %}
{%   set helper = hostvars[intf.dhcp.server].loopback.ipv4|ipaddr('address') %}
- path: interface[name={{ if_name }}]/subinterface[index={{ if_index }}]
  val:
   ipv4:
    dhcp-relay:
     admin-state: enable
     # gi-address: {{ loopback.ipv4|ipaddr('address') }}
     # use-gi-addr-as-src-ip-addr: True
{%   if intf.vrf is defined %}
     network-instance: default
{%   endif %}
     server:
     - {{ helper }}
     # trace-options:
     #  trace: ["messages"]

{% endfor %}
